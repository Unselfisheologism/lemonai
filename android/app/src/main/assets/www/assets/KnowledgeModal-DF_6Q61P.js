import{e as s,I as Me,p as ie,W as Y,N as Ee,r as p,c as z,a0 as ue,i as N,h as m,w as r,P as de,Q as Pe,ad as pe,ae as Ue,af as He,l as k,ag as ve,d as S,Y as me,ah as Le,j as _e,q as Be,t as w,F as K,O as ge,V as fe,g as ze,o as Ne,ai as Ve,aj as Re,k as h,B as Te,v as je,X as De,ak as Fe,al as Ke,Z as Ye,a3 as qe,a4 as Qe,f as O}from"./index-DfAoYx5F.js";import{s as We}from"./mcp-BKayjOAq.js";import{h as _}from"./http-gFURT5VZ.js";import{e as ce}from"./emitter-E5P-NQ8u.js";import{u as ye}from"./user-BYcZl5Be.js";import{u as be}from"./edit-BolPNpet.js";var Xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"}}]},name:"read",theme:"outlined"};function re(n){for(var l=1;l<arguments.length;l++){var c=arguments[l]!=null?Object(arguments[l]):{},v=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(c).filter(function(f){return Object.getOwnPropertyDescriptor(c,f).enumerable}))),v.forEach(function(f){Ze(n,f,c[f])})}return n}function Ze(n,l,c){return l in n?Object.defineProperty(n,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):n[l]=c,n}var he=function(l,c){var v=re({},l,c.attrs);return s(Me,re({},v,{icon:Xe}),null)};he.displayName="ReadOutlined";he.inheritAttrs=!1;const A="/api/agent",oe={getList(){return _.get(A)},getById(n){return _.get(`${A}/${n}`)},update(n,l,c,v,f){return _.put(`${A}/${n}`,{name:l,describe:c,mcp_server_ids:v,is_public:f})},create(n,l,c,v){return _.post(A,{name:n,describe:l,mcp_server_ids:c,is_public:v})},delete(n){return _.del(`${A}/${n}`)},generate(n,l,c){return _.post(`${A}/generate`,{question:n,conversation_id:l,is_public:c})}},Ge={class:"mcp-grid"},Je=["onClick"],et={class:"checkbox-icon"},tt={class:"mcp-content"},at={class:"mcp-name"},nt={class:"mcp-desc"},ot={__name:"agentsEdit",props:{visible:Boolean,id:String},emits:["update:visible","updateList"],setup(n,{emit:l}){const c=ye(),{user:v,membership:f,points:q}=Y(c),Q=be(),{agent:M}=Y(Q),y=n,b=l,e=Ee({name:"",describe:"",mcpids:[],is_public:!0}),C=p([]),u=p(""),x=p(!1),E=p("Create Agent");p(!1),p("Upgrade");const I=z(()=>!!y.id);z(()=>{var o;return!((o=f.value)!=null&&o.planName)});const $=async()=>{try{const o=await We.activate_servers();C.value=Array.isArray(o)?o:[]}catch(o){console.error("Error fetching MCP servers:",o)}},V=()=>{e.name="",e.describe="",e.mcpids=[],e.is_public=!0,u.value=""},R=async()=>{if(console.log("initAgent",y.id),V(),E.value=I.value?"Edit Agent":"Create Agent",!!I.value){x.value=!0;try{const o=await oe.getById(y.id);console.log("res",o),e.name=o.name||"",e.describe=o.describe||"",e.mcpids=o.mcp_server_ids||[],e.is_public=o.is_public}catch(o){console.error("initAgent error",o)}finally{x.value=!1}}};ue(()=>y.visible,async o=>{o&&(await $(),await R())});const T=async()=>{if(I.value)await oe.update(y.id,e.name,e.describe,e.mcpids,e.is_public),M.value&&M.value.id===y.id&&(M.value={...M.value,name:e.name,describe:e.describe,mcp_server_ids:e.mcpids,is_public:e.is_public}),ce.emit("updateAgentList");else{let o=await oe.create(e.name,e.describe,e.mcpids);ce.emit("addAgent",o)}b("update:visible",!1)},W=()=>{V(),b("update:visible",!1)},X=o=>{const g=e.mcpids.indexOf(o);g>-1?e.mcpids.splice(g,1):e.mcpids.push(o)};return(o,g)=>{const Z=Pe,j=de,G=pe,D=ve,J=Be("a-icon"),ee=He,te=Ue,ae=ge,ne=fe;return m(),N(ne,{open:n.visible,title:E.value,width:"800px",onCancel:W,onOk:T},{default:r(()=>[s(ae,{model:e,layout:"vertical"},{default:r(()=>[s(j,{label:"Name"},{default:r(()=>[s(Z,{value:e.name,"onUpdate:value":g[0]||(g[0]=d=>e.name=d),placeholder:"Please enter name"},null,8,["value"])]),_:1}),s(j,{label:"Description"},{default:r(()=>[s(G,{value:e.describe,"onUpdate:value":g[1]||(g[1]=d=>e.describe=d),rows:"4",placeholder:"Please enter describe"},null,8,["value"])]),_:1}),s(te,null,{default:r(()=>[s(ee,{key:"1",header:"Select MCP Services"},{default:r(()=>[s(D,{value:u.value,"onUpdate:value":g[2]||(g[2]=d=>u.value=d),placeholder:"Search MCP services",allowClear:"",style:{"margin-bottom":"16px"}},null,8,["value"]),k("div",Ge,[(m(!0),S(K,null,me(C.value,d=>(m(),S("div",{key:d.id,class:Le(["mcp-card",{selected:e.mcpids.includes(d.id)}]),onClick:a=>X(d.id)},[k("div",et,[e.mcpids.includes(d.id)?(m(),N(J,{key:0,type:"check-circle",style:{color:"#52c41a","font-size":"20px"}})):_e("",!0)]),k("div",tt,[k("div",at,w(d.name),1),k("div",nt,w(d.describe),1)])],10,Je))),128))])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}},yt=ie(ot,[["__scopeId","data-v-87c15c08"]]),L="/api/knowledge",B={create(n,l,c){return _.post(L,{content:n,category:l,agent_id:c})},getList(n){return _.get(L,{agent_id:n})},getById(n){return _.get(`${L}/detail/${n}`)},update(n,l,c){return _.put(`${L}/${n}`,{content:l,category:c})},delete(n){return _.del(`${L}/${n}`)},getCategoryList(){return _.get("/api/knowledge/categories")}},st={class:"toolbar"},lt={class:"table-container"},ct={key:2,class:"content-ellipsis"},rt={key:0,class:"overlay-mask"},it={class:"overlay-content"},ut={__name:"KnowledgeModal",props:{agentId:{type:Number,default:0}},setup(n,{expose:l}){const c=be(),{agent:v}=Y(c),f=ye(),{user:q,membership:Q,points:M}=Y(f),y=ze(),b=p(!1),e=p(!1),C=p(null),u=p({content:"",category:""}),x=p(""),E=p([]),I=p([]),$=p("personal"),V=n;function R(){return V.agentId||v.value.id}const T=z(()=>{var a;return!!((a=Q.value)!=null&&a.planName)}),W=z(()=>$.value==="system"&&!T.value),X=async()=>{try{const a=await B.getCategoryList();I.value=a||[]}catch(a){console.error(a)}},o=async()=>{try{const a=await B.getList(R());E.value=$.value==="system"?a.system||[]:a.personal||[]}catch(a){console.error(a)}},g=async a=>{a==="system"&&T.value,$.value=a,await o()},Z=z(()=>E.value.filter(a=>{var t,P;return((t=a.content)==null?void 0:t.includes(x.value))||((P=a.category)==null?void 0:P.includes(x.value))})),j=()=>{C.value=null,u.value={content:"",category:""},e.value=!0},G=a=>{C.value=a,u.value={content:a.content,category:a.category},e.value=!0},D=async()=>{var a;if(!u.value.content||!u.value.category){O.error("Please complete content and category.");return}try{(a=C.value)!=null&&a.id?(await B.update(C.value.id,u.value.content,u.value.category),O.success("Updated successfully.")):(await B.create(u.value.content,u.value.category,R()),O.success("Added successfully.")),e.value=!1,o()}catch(t){console.error(t),O.error("Operation failed.")}},J=async a=>{try{await B.delete(a),O.success("Deleted successfully."),o()}catch(t){console.error(t),O.error("Failed to delete.")}},ee=()=>{b.value=!1},te=()=>{b.value=!1},ae=()=>{},ne=()=>{const a=localStorage.getItem("access_token"),t=q.value&&q.value.id;!a||!t?y.push({name:"login"}):y.push({name:"pricing"})},d=[{title:"Content",dataIndex:"content",key:"content"},{title:"Category",dataIndex:"category",key:"category"},{title:"Created At",dataIndex:"create_at",key:"create_at",width:200},{title:"Actions",key:"action",width:100}];return Ne(()=>{X()}),ue(b,a=>{a&&o()}),l({visible:b}),(a,t)=>{const P=Ve,ke=Re,Ce=ve,U=Te,we=Ke,xe=Fe,$e=Ye,Se=pe,se=de,Ie=Qe,Oe=qe,Ae=ge,le=fe;return m(),N(le,{open:b.value,"onUpdate:open":t[7]||(t[7]=F=>b.value=F),title:"Experience Management",width:"900px",onCancel:ee,onOk:te,footer:null,"ok-text":"Close","cancel-button-props":{style:{display:"none"}}},{default:r(()=>{var F;return[s(ke,{activeKey:$.value,"onUpdate:activeKey":t[0]||(t[0]=i=>$.value=i),onChange:g,style:{"margin-bottom":"16px"}},{default:r(()=>[s(P,{key:"personal",tab:"Personal Experience"}),s(P,{key:"system",tab:"System Experience"})]),_:1},8,["activeKey"]),k("div",st,[s(Ce,{value:x.value,"onUpdate:value":t[1]||(t[1]=i=>x.value=i),placeholder:"Please enter content or category","enter-button":"",onSearch:ae,style:{"max-width":"300px"}},null,8,["value"]),s(U,{type:"primary",onClick:j},{default:r(()=>[...t[8]||(t[8]=[h("Add Experience",-1)])]),_:1})]),k("div",lt,[s($e,{columns:d,"data-source":Z.value,"row-key":"id",pagination:{pageSize:5}},{bodyCell:r(({column:i,record:H})=>[i.key==="create_at"?(m(),S(K,{key:0},[h(w(je(De)(H[i.dataIndex]).format("YYYY-MM-DD HH:mm")),1)],64)):i.key==="action"?(m(),N(xe,{key:1},{default:r(()=>[s(U,{type:"link",onClick:dt=>G(H)},{default:r(()=>[...t[9]||(t[9]=[h("Edit",-1)])]),_:1},8,["onClick"]),s(we,{title:"Are you sure to delete?",onConfirm:()=>J(H.id)},{default:r(()=>[s(U,{danger:"",type:"link"},{default:r(()=>[...t[10]||(t[10]=[h("Delete",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):i.key==="content"?(m(),S("div",ct,w(H[i.dataIndex]),1)):(m(),S(K,{key:3},[h(w(H[i.dataIndex]),1)],64))]),_:1},8,["data-source"]),W.value?(m(),S("div",rt,[k("div",it,[h(w(a.$t("setting.experience.systemExperienceRequiresUpgrade"))+" ",1),k("button",{onClick:ne,class:"upgrade"},w(a.$t("member.upgrade")),1)])])):_e("",!0)]),s(le,{open:e.value,"onUpdate:open":t[5]||(t[5]=i=>e.value=i),title:(F=C.value)!=null&&F.id?"Edit Experience":"Add Experience",onOk:D,onCancel:t[6]||(t[6]=i=>e.value=!1),width:700},{footer:r(()=>[s(U,{style:{"background-color":"#1a1a19","border-color":"#1a1a19",color:"#fff"},onClick:D},{default:r(()=>[...t[11]||(t[11]=[h(" Save ",-1)])]),_:1}),s(U,{onClick:t[4]||(t[4]=i=>e.value=!1)},{default:r(()=>[...t[12]||(t[12]=[h("Cancel",-1)])]),_:1})]),default:r(()=>[s(Ae,{model:u.value,layout:"vertical"},{default:r(()=>[s(se,{label:"Content"},{default:r(()=>[s(Se,{value:u.value.content,"onUpdate:value":t[2]||(t[2]=i=>u.value.content=i),rows:12,placeholder:"Enter content here"},null,8,["value"])]),_:1}),s(se,{label:"Category"},{default:r(()=>[s(Oe,{value:u.value.category,"onUpdate:value":t[3]||(t[3]=i=>u.value.category=i),placeholder:"Please select category","allow-clear":""},{default:r(()=>[(m(!0),S(K,null,me(I.value,i=>(m(),N(Ie,{key:i,value:i},{default:r(()=>[h(w(i),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])]}),_:1},8,["open"])}}},bt=ie(ut,[["__scopeId","data-v-d4ac529c"]]);export{yt as A,bt as K,he as R,oe as s};
